!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},r={},n={},i={}.hasOwnProperty,s=/^\.\.?(\/|$)/,a=function(e,t){for(var r,n=[],i=(s.test(t)?e+"/"+t:t).split("/"),a=0,o=i.length;o>a;a++)r=i[a],".."===r?n.pop():"."!==r&&""!==r&&n.push(r);return n.join("/")},o=function(e){return e.split("/").slice(0,-1).join("/")},u=function(t){return function(r){var n=a(o(t),r);return e.require(n,t)}},c=function(e,t){var n={id:e,exports:{}};return r[e]=n,t(n.exports,u(e),n),n.exports},l=function(e){return n[e]?l(n[e]):e},d=function(e,n){null==n&&(n="/");var s=l(e);if(i.call(r,s))return r[s].exports;if(i.call(t,s))return c(s,t[s]);throw new Error("Cannot find module '"+e+"' from '"+n+"'")};d.alias=function(e,t){n[t]=e},d.reset=function(){t={},r={},n={}};var f=/\.[^.\/]+$/,h=/\/index(\.[^\/]+)?$/,p=function(e){if(f.test(e)){var t=e.replace(f,"");i.call(n,t)&&n[t].replace(f,"")!==t+"/index"||(n[t]=e)}if(h.test(e)){var r=e.replace(h,"");i.call(n,r)||(n[r]=e)}};d.register=d.define=function(e,n){if("object"==typeof e)for(var s in e)i.call(e,s)&&d.register(s,e[s]);else t[e]=n,delete r[e],p(e)},d.list=function(){var e=[];for(var r in t)i.call(t,r)&&e.push(r);return e},d.brunch=!0,d._cache=r,e.require=d}}(),require.register("actions.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.setFontSize=function(e){return{type:"SET_FONT_SIZE",size:e}},e.setContrast=function(e){return{type:"SET_CONTRAST",contrast:e}},e.selectImage=function(e){return{type:"SELECT_IMAGE",image:e}},e.cacheDrawing=function(e){return{type:"CACHE_DRAWING",drawing:e}}}),require.register("components/Card.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=function(e){var t=e.title,r=e.children;return s["default"].createElement("div",{className:"Card"},s["default"].createElement("div",{className:"Card-header"},s["default"].createElement("h4",null,t)),r)}}),require.register("components/DownloadButton.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=s["default"].createClass({displayName:"DownloadButton",propTypes:{drawing:s["default"].PropTypes.string},handleDownload:function(e){var t=this.props.drawing,r=e.target;r.href=t,r.click()},render:function(){return s["default"].createElement("div",null,s["default"].createElement("a",{className:"Button",download:"pabla.jpg",target:"_blank",onClick:this.handleDownload},"Download"))}})}),require.register("components/FiltersPicker.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=s["default"].createClass({displayName:"FiltersPicker",propTypes:{contrast:s["default"].PropTypes.bool.isRequired,onContrastChange:s["default"].PropTypes.func.isRequired},updateContrast:function(){var e=this.refs.contrast.checked;this.props.onContrastChange(e)},render:function(){return s["default"].createElement("div",null,s["default"].createElement("label",null,s["default"].createElement("input",{ref:"contrast",checked:this.props.contrast,type:"checkbox",onChange:this.updateContrast})," Contrast"))}})}),require.register("components/ImageCanvas.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,s=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=t("react"),o=n(a),u={8:"backspace",27:"escape",37:"arr_left",39:"arr_right"},c=500,l=c-40-10,d=function(e,t){var r=t.getBoundingClientRect(),n={x:e.clientX-r.left,y:e.clientY-r.top};return n},f=function(e,t){return e.x>=t[0]&&e.x<=t[0]+t[2]&&e.y>=t[1]&&e.y<=t[1]+t[3]},h=function(e){var t=e.getContext("2d");if(window.devicePixelRatio){var r=e.width,n=e.height;e.width=r*window.devicePixelRatio,e.height=n*window.devicePixelRatio,window.c=e,e.style.width=r+"px",e.style.height=n+"px",t.scale(window.devicePixelRatio,window.devicePixelRatio)}},p=function(e,t){e.fillStyle="rgba(45, 45, 45, 0.45)",e.fillRect(0,0,t,t)},m=function(e,t,r){var n=r.naturalWidth,i=r.naturalHeight,s=n>i?i:n,a=i>n?i:n,o=s;e.drawImage(r,(a-s)/2,0,o,o,0,0,t,t)},g=function(e,t,r){var n=r.split(" "),i=[""],s=[[]],a=0;return n.forEach(function(r,n){var o=i.length-1,u=i[o],c=0===u.length?r:u+" "+r;if(e.measureText(c).width<=t||0===u.length){i[o]=c;0===u.length;s[o]=s[o].concat(r.split("").map(function(e,t){return a+1+t}))}else s.push(r.split("").map(function(e,t){return a+1+t})),i.push(r);s[i.length-1].push(a+1+r.length),a=a+1+r.length}),[i,s]},v=function(e,t,r,n,i){e.font=n+"px Georgia",e.fillStyle="white";var a=l,o=g(e,a,i),u=s(o,2),c=u[0],d=(u[1],1.3*n),f=void 0;return c.forEach(function(s,a){var o=t[0]+10,u=t[1]+n+a*d;r&&r.y<=u&&r.y>=u-d&&s.split("").forEach(function(t,n){var a=e.measureText(s.slice(0,n)).width,u=e.measureText(s.slice(0,n+1)).width,c=r.x-o;c>=a&&u>=c&&(f=i.indexOf(s)+n)})}),f},y=function(e,t){return[e[0]-t.x,e[1]-t.y,e[2],e[3]]},w=function(e,t,r){var n=1.3*t;return{x:e[0]+10,y:e[1]+t+r*n}},x=function(e,t,r){var n=l,i=g(e,n,r),a=s(i,2),o=(a[0],a[1]),u=o.find(function(e){return-1!==e.indexOf(t+1)}),c=void 0;if(u){var d=o.indexOf(u),f=u.indexOf(t+1);u.map(function(e){return r[e-1]}).join("");c={lineNo:d,idxInLine:f,line:u}}return c},C=function(e,t,r,n,i){var s=i.lineNo,a=i.idxInLine,o=i.line,u=o.map(function(e){return n[e-1]}).join(""),c=w(t,r,s),l=c.x,d=c.y,f=e.measureText(u.slice(0,a+1)).width;return{x:l+f,y1:d-r+7,y2:d+7}},S=function(e,t){var r=t.x,n=t.y1,i=t.y2;e.strokeStyle="rgba(255, 255, 255, 0.75)",e.lineWidth=1,e.lineCap="round",e.beginPath(),e.moveTo(r,n),e.lineTo(r,i),e.stroke(),e.strokeStyle=null},E=function(e,t,r,n,i,a){var o=r,u=n;if(o>u){var c=[u,o];o=c[0],u=c[1]}var d=x(e,o,a),f=x(e,u,a);if(d&&f){var h=g(e,l,a),p=s(h,2),m=(p[0],p[1]);if(d.lineNo===f.lineNo){var v=m.find(function(e){return-1!==e.indexOf(o+1)}),y=v.map(function(e){return a[e-1]}).join(""),C=w(t,i,d.lineNo),S=C.x,E=C.y,_=e.measureText(y.slice(0,d.idxInLine+1)).width,b=e.measureText(y.slice(d.idxInLine+1,f.idxInLine)).width;return[{x1:S+_,x2:S+_+b,y1:E-i+7,y2:E+7}]}var P=Array.apply(0,Array(f.lineNo-d.lineNo+1)).map(function(e,t){return t+d.lineNo});return P.map(function(r){var n=w(t,i,r),s=n.x,c=n.y,l=void 0,h=void 0;if(r==d.lineNo){var p=m.find(function(e){return-1!==e.indexOf(o+1)}),g=p.map(function(e){return a[e-1]}).join("");l=e.measureText(g.slice(0,d.idxInLine+1)).width,h=e.measureText(g.slice(d.idxInLine+1)).width}else if(r===f.lineNo){var v=m.find(function(e){return-1!==e.indexOf(u+1)}),y=v.map(function(e){return a[e-1]}).join("");l=0,h=e.measureText(y.slice(0,f.idxInLine)).width}else l=0,h=280;return{x1:s+l,x2:s+l+h,y1:c-i+7,y2:c+7}})}},_=function(e,t,r,n,a,o,u){e.font=r+"px Georgia",e.fillStyle="white";var c=l,d=g(e,c,u),f=s(d,2),h=f[0],p=(f[1],1.3*r);h.forEach(function(t,n){var i=w(o,r,n),s=i.x,a=i.y;e.fillText(t,s,a,o[2]-20)});var m=(Math.min(300,Math.max.apply(Math,i(h.map(function(t){return e.measureText(t).width})))),h.length*p);return o[3]=m+10,n&&(e.lineWidth=2,e.strokeStyle=a?"rgba(87, 205, 255, 0.5)":"#0092d1",e.strokeRect(o[0],o[1],o[2],o[3])),o};e["default"]=o["default"].createClass({displayName:"ImageCanvas",componentWillReceiveProps:function(e){this.redraw(e)},getInitialState:function(){return{text:"“Others have seen what is and asked why. I have seen what could be and asked why not. ” - Pablo Picasso"}},componentDidMount:function(){var e=this,t=this.refs.canvas;h(t),document.addEventListener("keypress",this.handleKeyUp),document.addEventListener("keydown",this.handleKeyDown),this.textRect=[20,20,c-40,c-40],this.cursor=0,setTimeout(this.doRedraw,100),setInterval(function(){e.showCursor=!e.showCursor,setTimeout(e.doRedraw,100)},450)},doRedraw:function(){this.redraw(this.props)},redraw:function(e){e||(e=this.props);var t=this.refs.canvas,r=t.getContext("2d"),n=this.mouseHeld,i=this.showCursor,s=this.textRect,a=(this.cursor,this.state),o=a.text,u=a.isFocused,l=a.isEditing,d=(a.mouseDiff,e.contrast),f=e.fontSize,h=[].slice.apply(document.images).find(function(t){return e.image.url===t.src});if(h){var g=c;m(r,g,h),d&&p(r,g),this.textRect=_(r,g,f,u,n,s,o);var v=void 0;if(l&&this.cursor1&&this.cursor2){var y=E(r,s,this.cursor1,this.cursor2,f,o);if(!y)return;v=!0,y.forEach(function(e){var t=e.x1,n=e.x2,i=e.y1,s=e.y2;r.fillStyle="rgba(87, 205, 255, 0.5)",r.fillRect(t,i,n-t,s-i)})}if(l&&i&&!v){var w=x(r,this.cursor,o);if(w){var b=C(r,s,f,o,w);S(r,b)}}this.props.onRedraw&&this.props.onRedraw(this.refs.canvas.toDataURL("image/jpeg"))}},cancelEditing:function(){this.setState({isEditing:!1}),setTimeout(this.doRedraw,50)},moveCursor:function(e,t){if(t=!1,!t||this.cursor1||this.cursor2||(this.cursor1=this.cursor2=this.cursor),t||(this.cursor1=this.cursor2=null),"left"===e)this.cursor=this.cursor-1,t&&(this.cursor2=this.cursor);else{if("right"!==e)return;this.cursor=this.cursor+1,t&&(this.cursor2=this.cursor)}setTimeout(this.doRedraw,50)},insertOrDeleteChar:function(e){var t=this.state.text,r=void 0;if(this.cursor1||this.cursor2){var n=this.cursor1,i=this.cursor2,s=t.slice(0,n+1),a=t.slice(i);e?(r=s+e+a,this.cursor1=null,this.cursor2=null,this.cursor=n+1):(r=s+a,this.cursor1=null,this.cursor2=null,this.cursor=n)}else{var o=this.cursor,u=t.slice(0,o+1),c=t.slice(o+1);e?(r=u+e+c,this.cursor=o+1):(r=u.slice(0,-1)+c,this.cursor=o-1)}this.setState({text:r}),setTimeout(this.doRedraw,50)},selectAll:function(){this.cursor1=1,this.cursor2=this.state.text.length,this.cursor=this.cursor2,setTimeout(this.doRedraw,150)},handleKeyDown:function(e){if(this.state.isEditing){if(65===e.which&&e.metaKey===!0)return e.preventDefault(),this.selectAll();switch(u[e.which]){case"escape":this.cancelEditing();break;case"arr_left":this.moveCursor("left",e.shiftKey);break;case"arr_right":this.moveCursor("right",e.shiftKey)}}},handleKeyUp:function(e){if("Meta"!==e.keyIdentifier&&"Alt"!==e.keyIdentifier&&"Control"!==e.keyIdentifier&&this.state.isEditing)if("backspace"===u[e.which])this.insertOrDeleteChar();else{var t=String.fromCharCode(e.charCode);e.shiftKey||(t=t.toLowerCase()),this.insertOrDeleteChar(t)}},handleMouseDown:function(e){var t=d(e,this.refs.canvas);this.startPos=t;var r=this.textRect,n=f(t,r);n?(this.mouseHeld=!0,this.state.isFocused&&(this.mouseDown=new Date),this.setState({isFocused:!0}),setTimeout(this.doRedraw,100)):(this.setState({isFocused:!1,isEditing:!1}),setTimeout(this.doRedraw,100))},handleMouseMove:function(e){if(this.mouseHeld){var t=d(e,this.refs.canvas),r={x:this.startPos.x-t.x,y:this.startPos.y-t.y};if(this.state.isFocused&&!this.state.isEditing)this.textRect=y(this.textRect,r),this.setState({mouseDiff:r}),this.startPos=t;else if(this.state.isFocused&&this.state.isEditing){var n=this.startPos,i=t,s=this.refs.canvas,a=s.getContext("2d"),o=this.textRect,u=this.state.text,c=this.props.fontSize,l=v(a,o,n,c,u),f=v(a,o,i,c,u);this.cursor1=l,this.cursor2=f}setTimeout(this.doRedraw,50)}},handleMouseUp:function(e){if(this.mouseDown&&new Date-this.mouseDown<200){var t=this.refs.canvas,r=t.getContext("2d"),n=(this.textRect,this.state.text),i=this.props.fontSize;this.cursor=v(r,this.textRect,this.startPos,i,n)||this.cursor,this.setState({isEditing:!0}),this.cursor1=null,this.cursor2=null,setTimeout(this.doRedraw,50)}this.setState({mouseDiff:null}),this.mouseDown=null,this.mouseHeld=!1,setTimeout(this.doRedraw,50)},render:function(){this.props.image||{};return o["default"].createElement("div",{className:"ImageCanvas"},o["default"].createElement("canvas",{ref:"canvas",width:c,height:c,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp}))}})}),require.register("components/ImagePicker.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=s["default"].createClass({displayName:"ImagePicker",propTypes:{images:s["default"].PropTypes.arrayOf(s["default"].PropTypes.shape({url:s["default"].PropTypes.string})).isRequired,selected:s["default"].PropTypes.shape({url:s["default"].PropTypes.string}),onSelect:s["default"].PropTypes.func},handleSelect:function(e){this.props.onSelect&&this.props.onSelect(e)},render:function(){var e=this,t=this.props.selected||{};return s["default"].createElement("div",{className:"ImagePicker"},this.props.images.map(function(r){var n=r.url===t.url;return s["default"].createElement("div",{className:"ImagePicker-image",onClick:function(){return e.handleSelect(r)},key:r.url},s["default"].createElement("img",{className:n?"ImagePicker-image--selected":null,src:r.url,crossOrigin:"anonymous"}))}))}})}),require.register("components/SizePicker.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=s["default"].createClass({displayName:"SizePicker",render:function(){return s["default"].createElement("span",null,"To be implemented.")}})}),require.register("components/TextPropertiesPicker.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i);e["default"]=s["default"].createClass({displayName:"TextPropertiesPicker",propTypes:{fontSize:s["default"].PropTypes.number.isRequired,onFontSizeChange:s["default"].PropTypes.func.isRequired},updateFontSize:function(){var e=parseInt(this.refs.fontSize.value,10);this.props.onFontSizeChange(e)},render:function(){return s["default"].createElement("div",null,"Font size:",s["default"].createElement("select",{ref:"fontSize",value:this.props.fontSize,onChange:this.updateFontSize},[8,10,12,14,16,18,20,22,26,32,36,42,48,54].map(function(e){return s["default"].createElement("option",{key:e,value:e},e)})))}})}),require.register("container/App.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i),a=t("react-redux"),o=t("actions"),u=t("./LeftSidebar"),c=n(u),l=t("./RightSidebar"),d=n(l),f=t("components/ImageCanvas"),h=n(f),p=s["default"].createClass({displayName:"App",updateDrawnImage:function(e){this.props.drawing!==e&&this.props.onCacheDrawing(e)},render:function(){return s["default"].createElement("div",{className:"Container"},s["default"].createElement(c["default"],null),s["default"].createElement("div",{className:"Main"},s["default"].createElement(h["default"],{image:this.props.selected,fontSize:this.props.fontSize,contrast:this.props.contrast,onRedraw:this.updateDrawnImage})),s["default"].createElement(d["default"],null))}}),m=function(e){return{fontSize:e.fontSize,contrast:e.contrast,selected:e.selectedImage,drawing:e.drawing}},g=function(e){return{onCacheDrawing:function(t){e((0,o.cacheDrawing)(t))}}};e["default"]=(0,a.connect)(m,g)(p)}),require.register("container/LeftSidebar.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i),a=t("react-redux"),o=t("actions"),u=t("components/Card"),c=n(u),l=t("components/ImagePicker"),d=n(l),f=function(e){var t=e.availableImages,r=e.selectedImage,n=e.onSelectImage;return s["default"].createElement("div",{className:"Sidebar"},s["default"].createElement(c["default"],{title:"Images"},s["default"].createElement(d["default"],{images:t,selected:r,onSelect:n})))},h=function(e){return{availableImages:e.availableImages,selectedImage:e.selectedImage}},p=function(e){return{onSelectImage:function(t){e((0,o.selectImage)(t))}}};e["default"]=(0,a.connect)(h,p)(f)}),require.register("container/RightSidebar.jsx",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(e,"__esModule",{value:!0});var i=t("react"),s=n(i),a=t("react-redux"),o=t("actions"),u=t("components/Card"),c=n(u),l=t("components/FiltersPicker"),d=n(l),f=t("components/TextPropertiesPicker"),h=n(f),p=t("components/SizePicker"),m=n(p),g=t("components/DownloadButton"),v=n(g),y=function(e){var t=e.drawing,r=e.contrast,n=e.onContrastChange,i=e.fontSize,a=e.onFontSizeChange;return s["default"].createElement("div",{className:"Sidebar"},s["default"].createElement(c["default"],{title:"Sizes"},s["default"].createElement(m["default"],null)),s["default"].createElement(c["default"],{title:"Filters"},s["default"].createElement(d["default"],{contrast:r,onContrastChange:n})),s["default"].createElement(c["default"],{title:"Text"},s["default"].createElement(h["default"],{fontSize:i,onFontSizeChange:a})),s["default"].createElement(v["default"],{drawing:t}),s["default"].createElement("p",{className:"Credit"},"Made by ",s["default"].createElement("a",{href:"http://goshakkk.name"},"Gosha Arinich"),". ",s["default"].createElement("a",{href:"https://github.com/goshakkk/pabla"},"Repo"),"."))},w=function(e){return{fontSize:e.fontSize,contrast:e.contrast}},x=function(e){return{onFontSizeChange:function(t){e((0,o.setFontSize)(t))},onContrastChange:function(t){e((0,o.setContrast)(t))}}};e["default"]=(0,a.connect)(w,x)(y)}),require.register("initialize.js",function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=t("react-dom"),s=n(i),a=t("react"),o=n(a),u=t("redux"),c=t("react-redux"),l=t("reducer"),d=n(l),f=t("container/App"),h=n(f),p=(0,u.createStore)(d["default"]);document.addEventListener("DOMContentLoaded",function(){s["default"].render(o["default"].createElement(c.Provider,{store:p},o["default"].createElement(h["default"],null)),document.querySelector("#app"))})}),require.register("reducer.js",function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?i:arguments[0],t=arguments[1];switch(t.type){case"SET_FONT_SIZE":return Object.assign({},e,{fontSize:t.size});case"SET_CONTRAST":return Object.assign({},e,{contrast:t.contrast});case"SELECT_IMAGE":return Object.assign({},e,{selectedImage:t.image});case"CACHE_DRAWING":return Object.assign({},e,{drawing:t.drawing});default:return e}};var n=[{url:"https://images.unsplash.com/photo-1458640904116-093b74971de9?fm=jpg"},{url:"https://images.unsplash.com/photo-1453227588063-bb302b62f50b?fm=jpg"},{url:"https://images.unsplash.com/photo-1451906278231-17b8ff0a8880?fm=jpg"},{url:"https://images.unsplash.com/photo-1447969025943-8219c41ea47a?fm=jpg"},{url:"https://images.unsplash.com/photo-1421749810611-438cc492b581?fm=jpg"},{url:"https://images.unsplash.com/photo-1449960238630-7e720e630019?fm=jpg"},{url:"https://images.unsplash.com/photo-1433190152045-5a94184895da?fm=jpg"}],i={fontSize:32,contrast:!0,availableImages:n,selectedImage:n[0],drawing:null}});